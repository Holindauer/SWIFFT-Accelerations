//==============================================================
// Copyright Â© 2022 Intel Corporation
//
// SPDX-License-Identifier: MIT
// =============================================================
#include <immintrin.h>
#include <stdlib.h>
#include <stdint.h>
#include <stdio.h>
#include <sys/syscall.h>
#include <unistd.h>
#include <stdbool.h>

#define MAX 1024
#define MAX_ROWS 16
#define MAX_COLS 64
#define STRIDE 64
#define ARCH_GET_XCOMP_PERM     0x1022
#define ARCH_REQ_XCOMP_PERM     0x1023
#define XFEATURE_XTILECFG       17
#define XFEATURE_XTILEDATA      18

// The following arrays represent 64x16 matrix stored in row major order
// Each of the 4 arrays contains an even 32x16 partitions of the original 
// 32x64 LibSWIFFT PI_key that have been zero padded to support 32 additional 
// rows of zeros to meet the AMX tile size requirements
int8_t PI_key_padded_partition_0[MAX] = {
    -116, 78, -118, 75, -19, -52, -128, 126, 22, -12, -60, -88, -115, 118, 105, 78, 52, -54, 91, 96, -60, 69, -123, -44, -121, 93, 3, -8, -116, 16, -47, 73,
    -128, -98, 105, -74, -115, -128, 86, 21, -120, -119, -33, -34, -67, -69, -78, -69, 4, -64, -46, 92, 115, 49, 59, -40, -39, 96, 61, 81, 24, -55, -59, 89,
    0, -56, 65, -29, 21, -104, 124, -27, 44, 35, 44, 108, 85, -101, -8, -50, 46, -87, 2, 69, -23, 36, 56, -94, 28, -105, 104, -19, -95, 56, 24, 58,
    -106, -15, 119, -18, 52, 112, -88, 28, 13, 37, -97, 60, -99, 81, -124, 60, -25, 85, 126, -90, -60, 100, 103, -91, 64, -32, 125, -52, 117, -122, 84, 128,
    11, -32, 87, -38, 126, -121, -120, -77, -59, 48, 68, -54, -18, -5, -63, -22, -79, -71, -128, 102, 89, -73, -77, 41, -108, 96, -92, 72, -32, -26, -123, -99,
    -11, 51, 103, -91, -11, 75, 9, -57, -96, 4, 108, 35, -128, -89, -49, -113, -36, -25, -88, 64, -69, -58, -20, -8, -84, -39, -61, -66, 48, -33, 5, 113,
    -75, 48, 85, -110, -13, -93, -11, 68, 38, -67, -37, 35, -55, 91, -100, -106, 44, -8, -81, 102, -93, 125, -110, 120, 18, -66, -71, 125, 64, 65, -59, -100,
    -114, -6, -10, -102, -121, -127, 88, 14, 74, 121, -7, -124, 21, -31, -72, -25, 19, 47, 120, 87, -111, 70, -25, 120, -66, 45, 33, 38, 19, -9, 110, 110,
    -89, 65, 53, -119, -80, 56, -38, 0, 58, 121, -109, 18, 44, 100, -42, 103, -107, -38, 12, 81, -60, -107, -126, 13, -88, 63, -82, -73, 48, -22, 65, -14,
    -11, -54, -59, -80, 0, 28, -63, 85, -34, 109, -102, -110, -36, 60, -124, 108, 78, -79, 46, 33, -29, -42, 104, 31, -50, -71, 82, 41, 42, 39, 103, 119,
    69, 47, -42, -76, -95, -118, 72, -57, 45, -94, -98, 62, 2, -36, 124, 40, 31, -106, 27, -117, 77, -95, 7, 27, 84, -29, -70, -37, 53, 126, -95, -15,
    110, -128, 112, 47, 18, 61, -123, 78, 73, 79, -3, -25, 125, -77, -52, 54, -128, 4, 15, 92, 6, 116, 69, -61, 48, -123, 84, 81, 111, 56, 38, -81,
    120, -5, 0, -52, 28, 42, -64, 64, 39, 37, 83, -82, 5, -39, -42, -83, 11, -106, -26, -61, 12, 122, -95, 56, 17, 114, -66, -50, 90, -125, 64, -19,
    -7, 5, 65, -116, 68, 116, -26, 113, 10, -39, 99, -52, -56, 92, -100, 4, -76, -106, 0, 6, -111, -71, 68, 55, 54, 58, -44, -75, 60, -26, 33, -25,
    73, -124, -46, 86, 120, -116, 122, -16, 127, 56, -127, 36, -83, 75, 83, -11, 34, 94, -116, -72, 18, -23, -100, 109, 104, 64, -7, 125, 49, -21, 86, 48,
    -107, 7, 127, 119, -108, -13, 84, -72, -123, 34, 128, -64, -21, -23, -125, 117, 79, 31, 107, -7, -63, -101, -71, 69, -45, 66, 41, -77, -118, 42, -46, -4,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
};

int8_t PI_key_padded_partition_1[MAX] = {
    50, -108, 29, -49, 114, 34, 85, 117, 67, -109, 86, -1, 25, 49, -124, 93, 6, 92, 58, 74, -83, 6, -3, 91, -56, 107, 110, 76, 103, 11, 73, 16,
    -1, 25, -40, -81, 36, -81, -19, 127, -97, -47, -102, -109, -125, 0, 54, 127, 45, 128, 8, 51, -4, 87, -86, 35, 4, -69, -86, 10, 3, -120, -19, 73,
    26, -35, -126, 1, 60, -15, -60, -107, -76, 19, 116, -44, 75, 98, 124, -17, 38, -107, -64, -3, -4, 125, -84, 35, 73, 126, -10, -18, -41, 6, -58, 15,
    16, -112, -8, -65, -84, -40, -43, 93, -116, -73, 54, 34, -96, 104, -100, 95, -26, 112, 90, -16, 28, 22, -47, -110, -71, 49, -27, 21, 108, 39, -63, 47,
    -115, -120, -83, -85, -67, -112, -7, -36, -75, -53, 1, -62, -127, -104, 83, -16, -58, 28, -8, 16, -32, -62, 10, -47, -93, -5, -119, 8, 35, -105, -44, -58,
    50, 14, 13, -37, 41, -125, 122, 127, -63, 9, -25, -23, 107, 28, -70, 8, 100, -91, -97, 21, -66, -60, 61, -95, -108, -86, -17, -74, -128, -26, 123, -53,
    -56, -17, -72, -39, 4, -105, 2, -125, -80, 88, -67, -61, -28, 74, -37, -122, -93, -44, 95, 61, 13, -76, -49, 91, -15, -60, -99, 34, 98, -88, 91, 14,
    118, -125, 89, 64, -53, -96, 2, 70, -33, -98, 35, -53, 123, -77, 13, 52, 44, 64, 2, 84, -13, -29, -5, -29, -87, 123, 38, -113, -44, -113, -86, -45,
    -112, -28, 117, -61, 91, 89, 113, -114, -85, -18, -8, -73, -103, 39, 112, 65, -108, -57, -94, -3, -55, 114, -10, 67, -114, -7, 126, -29, 80, -127, -41, -43,
    -100, -3, 26, 75, -100, -72, 49, -115, 31, -120, 71, 43, 63, 64, -20, -109, 123, -124, -14, -3, -19, -101, 90, -71, 37, -45, 33, 107, -5, 51, -80, 36,
    -98, -15, 35, -49, -78, -91, 98, 67, -79, 68, -114, -32, -79, -111, -70, -98, 84, -76, -34, 103, 86, -80, -50, 31, -117, 18, -50, -1, -56, -91, 96, 23,
    -37, 119, 63, 89, -76, 52, 77, 109, -106, 77, 80, -50, -113, 25, 20, 6, -18, 6, 128, 72, -15, -123, 36, -36, 59, 48, -15, 68, -127, 110, -86, 89,
    128, 121, -26, 11, -107, -112, -122, -60, -121, 91, -64, 5, 107, 88, 82, 6, -70, 6, -59, -81, -17, 88, 118, -21, 15, -31, -91, 22, -64, -28, 82, -11,
    97, 46, 49, -37, 72, -118, 103, -86, -108, -128, -64, 19, 69, -12, 43, 31, 77, -47, -41, -103, 80, 51, -116, 122, 68, -109, -38, 122, -3, 48, 64, -82,
    112, 45, -121, -63, -56, 115, 1, -101, 114, -90, -49, 12, -81, -110, 32, -87, -61, 77, 75, -20, -101, 103, -32, 19, 110, -28, 22, 68, -80, 93, -36, -76,
    -120, 32, -112, -73, 44, 121, 51, 76, 11, -29, -115, -6, 39, 77, -29, -6, -1, -18, 29, -128, 104, -9, -75, 68, 1, -68, 48, -31, 36, -28, 3, -99,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
};

int8_t PI_key_padded_partition_2[MAX] = {
    95, 36, 68, -26, -46, 102, -106, 128, -33, 117, -64, 27, 102, -70, 7, 105, 34, -48, 7, 127, -111, -3, 95, -81, 57, 13, 108, -12, 77, 92, -71, 117,
    -112, 6, 46, 85, -14, 95, -84, 123, -79, -50, -46, -74, -33, -84, -111, 35, 19, -49, 124, -94, 103, -80, -102, -110, 46, 84, -4, -24, -86, -16, -46, -40,
    123, -50, 62, -2, 60, -114, -70, -100, -118, 9, 12, 104, 89, 49, -64, -111, 90, 12, 97, 122, 9, 84, -50, 127, -38, 72, 58, 30, 29, -75, 41, -65,
    38, -124, -39, -30, -46, -76, 9, 66, -120, -114, 77, 33, -9, -98, 4, 55, 123, -58, 107, 114, 30, -47, -7, -114, 59, -101, -126, -124, -36, 27, 76, 99,
    -96, -18, -46, -119, 11, -88, -102, -12, -83, 49, 10, -91, 16, -127, -76, -118, 82, 116, 97, -27, 63, -58, -16, 35, 79, 120, 54, -83, 67, 112, 1, 76,
    51, -116, 97, -36, -32, 9, 113, -87, -91, 102, -122, 22, -26, -72, -30, -70, -65, -78, -123, 15, 47, -96, -115, -80, -18, -23, -71, -20, -26, 53, -49, 95,
    -120, -61, 11, 47, 5, -6, 106, -113, -94, 60, -35, 127, 52, 57, -55, 102, 17, 93, -100, 17, 65, 30, -74, 6, -118, 58, -2, 108, 100, -121, -48, -113,
    -26, 57, 25, 78, 66, 69, 97, 42, -59, 84, -81, 59, 8, -25, 125, -123, -14, 87, -68, 46, 128, 110, 84, 77, 65, -74, 61, -73, 101, 44, -89, 68,
    -53, 42, 84, 38, -102, -106, -106, 16, 100, 87, -83, -95, -112, -110, -108, -71, 36, 2, -27, 33, 119, 125, 3, -115, -20, 100, 3, -105, -60, -83, -13, -128,
    -20, -85, -98, -97, -102, -3, -23, -33, -117, -64, 114, -117, 62, 109, -121, 39, -20, 76, -98, -12, 93, -43, 97, 56, -67, 38, -97, 94, 105, -35, -37, -99,
    57, 66, -81, -65, -21, -7, -89, -33, 122, 43, -98, 120, -124, -92, 122, 64, -24, 103, -60, 84, -96, 75, 59, -108, -119, -103, 119, 92, 16, 53, 116, 97,
    -49, 47, -56, -51, -65, 14, 73, -81, -1, -56, -50, 87, -41, 60, 56, 73, 13, -37, 48, 29, 5, 75, 104, -24, 91, -128, 105, -95, 44, 113, -94, -94,
    4, -69, -1, 70, 40, 2, -90, 57, -88, -54, 115, -3, -42, -85, 84, 80, -44, 64, 37, 63, 31, -14, -5, 37, -101, 38, -82, -53, -119, -116, -46, 82,
    58, 68, 36, -62, -98, 22, 54, 34, -24, -116, -52, 100, -31, 96, 22, -65, 41, 115, 62, -14, -116, 81, 119, 121, 5, 68, 121, 88, -18, 29, -27, 90,
    -6, 100, 102, -37, 122, -47, 6, 49, 75, -56, 38, 105, -125, -122, 126, 102, -105, -104, 61, 108, 101, 74, -10, -62, 127, -41, 30, -91, -89, 61, 83, -28,
    41, 58, -11, 107, 125, -70, 9, -17, 35, 8, 11, -95, -15, -37, -99, -94, 41, 53, -16, 22, 115, -83, 16, -94, -33, 19, 112, -38, -80, -24, 42, 27,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
};

int8_t PI_key_padded_partition_3[MAX] = {
    45, -127, 108, 124, -86, -106, -68, 128, -39, -123, -24, -92, 14, -56, -112, -123, 124, 97, 105, 118, 34, 74, -52, 122, -22, 53, 94, -19, -47, -30, -74, 11,
    71, 114, 50, 22, -82, 1, 28, 19, 112, -128, 21, 34, -96, -98, 115, 52, -98, 48, 96, 79, -20, 18, -86, -31, 99, 1, 97, -62, -41, -94, -59, 95,
    104, -61, -76, 82, -59, -4, -65, -66, -2, 122, -45, 104, 47, 20, -125, -49, -22, -9, -20, 74, 72, -81, -47, -5, 45, 64, -92, 87, -55, -16, -21, -34,
    -29, 48, 99, -38, -35, -73, 15, 36, -3, -1, -100, -20, 87, -118, -48, 113, -49, -7, 78, 12, -46, -116, 95, 81, -62, 106, 8, -25, -107, -45, -52, -36,
    -35, -35, 112, 99, 124, 94, 51, -14, -124, -63, -13, -121, 35, -9, -56, -80, 69, -35, -63, 96, 82, 94, 25, -29, -61, -112, -102, -121, -29, -23, 46, 101,
    110, -112, -6, -111, 76, 22, -111, -29, 7, 53, 64, 25, 62, -59, -127, -67, -111, 36, -32, -26, 89, -115, 93, -9, -120, 124, 83, 39, 69, 77, 89, -49,
    64, -117, 110, -51, 23, -75, 39, -12, 1, -94, -100, -71, -94, 80, 7, -27, -93, 6, -20, 33, -47, 110, 57, 126, -60, -121, 125, -13, -92, -106, -89, 3,
    -64, 2, -25, 109, -41, 69, 90, -115, 32, 38, -8, 37, 75, -77, -73, -69, 14, 106, 105, 8, -30, -46, -91, 39, -105, 43, 52, -3, -60, 55, 119, 89,
    -20, -112, -123, -113, -59, -22, -44, -94, 48, -27, 24, 47, 57, 71, 127, 0, -25, 30, -51, -58, 39, -47, -37, 43, -20, -36, -56, 54, -78, 42, 28, -124,
    -2, 8, -99, -111, 128, 49, -35, 96, 57, -48, -77, -8, -55, 127, 113, -26, 49, 16, -66, 52, 120, 87, -78, 2, 27, -113, -34, -27, -73, 6, -128, -30,
    87, 74, -96, -16, 9, 87, 90, 24, -2, 113, -54, -37, 57, -118, -60, -98, -37, 114, 35, 45, 77, -48, 40, -61, 71, 22, 81, -79, 110, 14, 3, -77,
    92, -14, -78, 113, 49, 59, 55, -89, 121, -120, 69, -103, 95, 57, -70, 47, 85, -110, -67, 111, -60, 80, -44, -104, 81, 68, -54, 33, -96, -92, 10, 61,
    -69, -90, 34, -120, 43, -14, 2, 79, -79, 38, -69, -122, -24, -63, -49, 13, 106, -40, 97, -118, -104, 56, -128, -39, -99, 9, 83, 26, 87, 112, 71, 21,
    41, -26, 24, 79, -23, -119, 30, 120, 117, -41, -85, -60, -85, 107, 86, 29, -122, -98, 35, -34, -89, 112, 49, 37, -111, 60, 126, -123, 42, -112, 115, 90,
    13, 121, 76, -29, -55, 20, 61, -44, -11, 13, -50, 42, -109, -89, 37, -4, 120, -101, 96, 120, -56, 124, 43, 27, -4, -7, 120, -114, 89, -22, -68, -14,
    2, -73, -94, -30, -15, 2, 100, 101, 2, 78, -128, 34, 89, 28, 26, -100, -7, -123, 18, 28, -112, 122, 68, 34, -123, 31, -110, 17, 39, -69, -107, 76,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
};


//Define tile config data structure 
typedef struct __tile_config
{
  uint8_t palette_id;
  uint8_t start_row;
  uint8_t reserved_0[14];
  uint16_t colsb[16]; 
  uint8_t rows[16]; 
} __tilecfg;

/* Initialize tile config */
static void init_tile_config (__tilecfg *tileinfo)
{
  int i;
  tileinfo->palette_id = 1;
  tileinfo->start_row = 0;

  for (i = 0; i < 1; ++i)
  {
    tileinfo->colsb[i] = MAX_ROWS;
    tileinfo->rows[i] =  MAX_ROWS;
  }

  for (i = 1; i < 4; ++i)
  {
    tileinfo->colsb[i] = MAX_COLS;
    tileinfo->rows[i] =  MAX_ROWS;
  }

  _tile_loadconfig (tileinfo);
}

/* Initialize int8_t buffer */
static void init_buffer (int8_t *buf, int8_t value)
{
  int rows, colsb, i, j;
  rows  = MAX_ROWS;
  colsb = MAX_COLS;

  for (i = 0; i < rows; i++)
    for (j = 0; j < colsb; j++)
    {
        buf[i * colsb + j] = value;
    }
}

/* Initialize int32_t buffer */
static void init_buffer32 (int32_t *buf, int32_t value)
{
  int rows, colsb, i, j;
  rows  = MAX_ROWS;
  colsb = MAX_COLS;
  int colsb2=colsb/4;

  for (i = 0; i < rows; i++)
    for (j = 0; j < (colsb2); j++)
    {
        buf[i * colsb2 + j] = value;
    }
}

/* Set_tiledata_use() - Invoke syscall to set ARCH_SET_STATE_USE */
static bool set_tiledata_use()
{
   if (syscall(SYS_arch_prctl, ARCH_REQ_XCOMP_PERM, XFEATURE_XTILEDATA)) 
   {
      printf("\n Fail to do XFEATURE_XTILEDATA \n\n");
      return false;
   }
   else
   {
      printf("\n TILE DATA USE SET - OK \n\n");
      return true;
   }

   return true;
}

/* Print int8_t buffer */
static void print_buffer(int8_t* buf, int32_t rows, int32_t colsb) 
{
   for (int i = 0; i < rows; i++) {
     for (int j = 0; j < (colsb); j++)
     {
         printf("%d ", buf[i * colsb + j]);
     }
     printf("\n");
   }
   printf("\n");
}

/* Print int32_t buffer */
static void print_buffer32(int32_t* buf, int32_t rows, int32_t colsb)
{
   for (int i = 0; i < rows; i++) {
     for (int j = 0; j < (colsb); j++)
     {
         printf("%d ", buf[i * colsb + j]);
     }
     printf("\n");
   }
   printf("\n");
}


int main(){

   __tilecfg tile_data = {0};
   int8_t src1[MAX];
   int32_t res[MAX/4];
   int rows  = MAX_ROWS;
   int colsb = MAX_COLS;

   // Request permission to linux kernel to run AMX 
   if (!set_tiledata_use())
      exit(-1);

   // Load tile configuration 
   init_tile_config (&tile_data);

   // Init src matrix buffers with data
   init_buffer (src1, 1);
   print_buffer(src1, rows, colsb);

   // Print first padded partition
   print_buffer(PI_key_padded_partition_0, rows, colsb);
 
   // Init dst matrix buffers with data
   init_buffer32 (res, 0);

   // Load tile rows from memory
   _tile_loadd (2, src1, STRIDE);
   _tile_loadd (3, PI_key_padded_partition_0, STRIDE);
   _tile_loadd (1, res, STRIDE);

   // Compute dot-product of bytes in tiles 
   _tile_dpbssd (1, 2, 3);

   // Store the tile data to memory
   _tile_stored (1, res, STRIDE);
   print_buffer32(res, rows, colsb/4);

   // Release the tile configuration to return to the init state, 
   // which releases all storage it currently holds
   _tile_release ();
}